<?php
/**
 * Array Language
 */ 
$languages = array(
	array('ca_ES', __('Catalan', 'g_locker')),
	array('cs_CZ', __('Czech', 'g_locker')),
	array('cy_GB', __('Welsh', 'g_locker')),
	array('da_DK', __('Danish', 'g_locker')),
	array('de_DE', __('German', 'g_locker')),
	array('eu_ES', __('Basque', 'g_locker')),
	array('en_US', __('English', 'g_locker')),
	array('es_ES', __('Spanish', 'g_locker')),
	array('fi_FI', __('Finnish', 'g_locker')), 
	array('fr_FR', __('French', 'g_locker')), 
	array('gl_ES', __('Galician', 'g_locker')), 
	array('hu_HU', __('Hungarian', 'g_locker')),
	array('it_IT', __('Italian', 'g_locker')),
	array('ja_JP', __('Japanese', 'g_locker')),
	array('ko_KR', __('Korean', 'g_locker')),
	array('nb_NO', __('Norwegian', 'g_locker')),
	array('nl_NL', __('Dutch', 'g_locker')),
	array('pl_PL', __('Polish', 'g_locker')),
	array('pt_BR', __('Portuguese (Brazil)', 'g_locker')),
	array('pt_PT', __('Portuguese (Portugal)', 'g_locker')),
	array('ro_RO', __('Romanian', 'g_locker')),
	array('ru_RU', __('Russian', 'g_locker')),
	array('sk_SK', __('Slovak', 'g_locker')),  
	array('sl_SI', __('Slovenian', 'g_locker')), 
	array('sv_SE', __('Swedish', 'g_locker')),
	array('th_TH', __('Thai', 'g_locker')),
	array('tr_TR', __('Turkish', 'g_locker')), 
	array('ku_TR', __('Kurdish', 'g_locker')), 
	array('zh_CN', __('Simplified Chinese (China)', 'g_locker')), 
	array('zh_HK', __('Traditional Chinese (Hong Kong)', 'g_locker')),
	array('zh_TW', __('Traditional Chinese (Taiwan)', 'g_locker')), 
	array('af_ZA', __('Afrikaans', 'g_locker')),
	array('sq_AL', __('Albanian', 'g_locker')),
	array('hy_AM', __('Armenian', 'g_locker')),
	array('az_AZ', __('Azeri', 'g_locker')),
	array('be_BY', __('Belarusian', 'g_locker')),
	array('bn_IN', __('Bengali', 'g_locker')),
	array('bs_BA', __('Bosnian', 'g_locker')),
	array('bg_BG', __('Bulgarian', 'g_locker')),
	array('hr_HR', __('Croatian', 'g_locker')),
	array('nl_BE', __('Dutch (België)', 'g_locker')),
	array('eo_EO', __('Esperanto', 'g_locker')),
	array('et_EE', __('Estonian', 'g_locker')),
	array('fo_FO', __('Faroese', 'g_locker')),
	array('ka_GE', __('Georgian', 'g_locker')),
	array('el_GR', __('Greek', 'g_locker')),
	array('gu_IN', __('Gujarati', 'g_locker')),
	array('hi_IN', __('Hindi', 'g_locker')),
	array('is_IS', __('Icelandic', 'g_locker')),
	array('id_ID', __('Indonesian', 'g_locker')),
	array('ga_IE', __('Irish', 'g_locker')),
	array('jv_ID', __('Javanese', 'g_locker')),
	array('kn_IN', __('Kannada', 'g_locker')),
	array('kk_KZ', __('Kazakh', 'g_locker')),
	array('la_VA', __('Latin', 'g_locker')),
	array('lv_LV', __('Latvian', 'g_locker')),
	array('li_NL', __('Limburgish', 'g_locker')),
	array('lt_LT', __('Lithuanian', 'g_locker')), 
	array('mk_MK', __('Macedonian', 'g_locker')), 
	array('mg_MG', __('Malagasy', 'g_locker')),
	array('ms_MY', __('Malay', 'g_locker')),
	array('mt_MT', __('Maltese', 'g_locker')),
	array('mr_IN', __('Marathi', 'g_locker')),
	array('mn_MN', __('Mongolian', 'g_locker')),
	array('ne_NP', __('Nepali', 'g_locker')),
	array('pa_IN', __('Punjabi', 'g_locker')),
	array('rm_CH', __('Romansh', 'g_locker')),
	array('sa_IN', __('Sanskrit', 'g_locker')),
	array('sr_RS', __('Serbian', 'g_locker')),
	array('so_SO', __('Somali', 'g_locker')),
	array('sw_KE', __('Swahili', 'g_locker')),
	array('tl_PH', __('Filipino', 'g_locker')),
	array('ta_IN', __('Tamil', 'g_locker')),
	array('tt_RU', __('Tatar', 'g_locker')), 
	array('te_IN', __('Telugu', 'g_locker')),
	array('ml_IN', __('Malayalam', 'g_locker')),
	array('uk_UA', __('Ukrainian', 'g_locker')),
	array('uz_UZ', __('Uzbek', 'g_locker')),
	array('vi_VN', __('Vietnamese', 'g_locker')),
	array('xh_ZA', __('Xhosa', 'g_locker')),
	array('zu_ZA', __('Zulu', 'g_locker')),
	array('km_KH', __('Khmer', 'g_locker')),
	array('tg_TJ', __('Tajik', 'g_locker')),
	array('ar_AR', __('Arabic', 'g_locker')), 
	array('he_IL', __('Hebrew', 'g_locker')),
	array('ur_PK', __('Urdu', 'g_locker')),
	array('fa_IR', __('Persian', 'g_locker')),
	array('sy_SY', __('Syriac', 'g_locker')),  
	array('yi_DE', __('Yiddish', 'g_locker')),
	array('gn_PY', __('Guaraní', 'g_locker')),
	array('qu_PE', __('Quechua', 'g_locker')),
	array('ay_BO', __('Aymara', 'g_locker')),
	array('se_NO', __('Northern Sámi', 'g_locker')),
	array('ps_AF', __('Pashto', 'g_locker'))
);

/**
 * Registers the settings via the Settings API,
 * appends the setting to the tabs array of the object.
 */
function gl_register_settings( ) {
    register_setting( gl_get_general_settings_key(), gl_get_general_settings_key() );
    
    // General	
    add_settings_section( 'section_social', 'Social', '__return_false', gl_get_general_settings_key() );
    add_settings_field( 'google_active', 'Google Plus Button', 'gl_field_googleActive', gl_get_general_settings_key(), 'section_social' );
    add_settings_field( 'google_share', 'Google Share Button', 'gl_field_google_share', gl_get_general_settings_key(), 'section_social' );
    add_settings_field( 'google_url', 'Google URL', 'gl_field_googleURL', gl_get_general_settings_key(), 'section_social' );
    add_settings_field( 'youtube_active', 'Display Youtube', 'gl_field_youtube_active', gl_get_general_settings_key(), 'section_social' );
    add_settings_field( 'youtube_channel', 'Youtube Channel', 'gl_field_youtube_channel', gl_get_general_settings_key(), 'section_social' );
    
    add_settings_section( 'section_advance', 'Advance', '__return_false', gl_get_general_settings_key() );
    add_settings_field( 'language', 'Language', 'gl_field_languages', gl_get_general_settings_key(), 'section_advance' );
    add_settings_field( 'cookie_days', 'Cookie', 'gl_field_cookieDays', gl_get_general_settings_key(), 'section_advance' );
    
    // Social locker
    register_setting( gl_get_social_lock_settings_key(), gl_get_social_lock_settings_key() );
    add_settings_section( 'section_social_lock', 'Social Locker Settings', '__return_false', gl_get_social_lock_settings_key() );
    add_settings_field( 'sl_title', 'Title', 'gl_field_sl_title', gl_get_social_lock_settings_key(), 'section_social_lock' );
    add_settings_field( 'sl_message', 'Message', 'gl_field_sl_message', gl_get_social_lock_settings_key(), 'section_social_lock' );
    
    add_settings_section( 'section_theme', 'Theme Options', '__return_false', gl_get_social_lock_settings_key() );
    add_settings_field( 'sl_style', 'Style', 'gl_field_sl_style', gl_get_social_lock_settings_key(), 'section_theme' );
    add_settings_field( 'sl_title_color', 'Title Color', 'gl_field_sl_title_color', gl_get_social_lock_settings_key(), 'section_theme' );
    add_settings_field( 'sl_message_color', 'Message Color', 'gl_field_sl_message_color', gl_get_social_lock_settings_key(), 'section_theme' );
    add_settings_field( 'sl_bg_color', 'Background Color', 'gl_field_sl_bg_color', gl_get_social_lock_settings_key(), 'section_theme' );
    add_settings_field( 'sl_shadow_color', 'Shadow Color', 'gl_field_sl_shadow_color', gl_get_social_lock_settings_key(), 'section_theme' );
    add_settings_field( 'sl_layout', 'Social Layout', 'gl_field_sl_layout', gl_get_social_lock_settings_key(), 'section_theme' );
    add_settings_field( 'sl_btn_effect', 'Social Button Effect', 'gl_field_sl_btn_effect', gl_get_social_lock_settings_key(), 'section_theme' );
	
    add_settings_field( 'preview', 'Preview', 'gl_field_preview_social', gl_get_social_lock_settings_key(), 'section_theme' );
    
    // Content locker
    register_setting( gl_get_content_lock_settings_key(), gl_get_content_lock_settings_key() );
    add_settings_section( 'section_content_lock', 'Content Locker Settings', '__return_false', gl_get_content_lock_settings_key() );
    add_settings_field( 'cl_title', 'Title', 'gl_field_cl_title', gl_get_content_lock_settings_key(), 'section_content_lock' );
    add_settings_field( 'cl_message', 'Message', 'gl_field_cl_message', gl_get_content_lock_settings_key(), 'section_content_lock' );
    
    add_settings_section( 'section_theme', 'Theme Options', '__return_false', gl_get_content_lock_settings_key() );
    add_settings_field( 'cl_style', 'Style', 'gl_field_cl_style', gl_get_content_lock_settings_key(), 'section_theme' );
    add_settings_field( 'cl_title_color', 'Title Color', 'gl_field_cl_title_color', gl_get_content_lock_settings_key(), 'section_theme' );
    add_settings_field( 'cl_message_color', 'Message Color', 'gl_field_cl_message_color', gl_get_content_lock_settings_key(), 'section_theme' );
    add_settings_field( 'cl_bg_color', 'Background Color', 'gl_field_cl_bg_color', gl_get_content_lock_settings_key(), 'section_theme' );
    add_settings_field( 'cl_shadow_color', 'Shadow Color', 'gl_field_cl_shadow_color', gl_get_content_lock_settings_key(), 'section_theme' );
    add_settings_field( 'cl_layout', 'Social Layout', 'gl_field_cl_layout', gl_get_content_lock_settings_key(), 'section_theme' );
    add_settings_field( 'cl_btn_effect', 'Social Button Effect', 'gl_field_cl_btn_effect', gl_get_content_lock_settings_key(), 'section_theme' );
	
    add_settings_field( 'preview', 'Preview', 'gl_field_preview_content', gl_get_content_lock_settings_key(), 'section_theme' );
    
    // How to use
    register_setting( gl_get_howtouse_settings_key(), gl_get_howtouse_settings_key() );
}

/**
 * General Option field callback
 */
function gl_field_checkbox( $settings_values, $settings_key, $key, $short_desc = null, $desc = null ) {
	?>
	<input type="checkbox" name="<?php echo $settings_key; ?>[<?php echo $key; ?>]" value="1" <?php echo esc_attr( $settings_values[$key]? "checked" : "" ); ?>> <?php if ( $short_desc ) echo $short_desc; ?><br><br>
	<span style="color:#999"><em><?php if ( $desc ) echo $desc; ?></em></span>
	<?php
}

function gl_field_text($settings_values, $settings_key, $key, $isColor = false, $short_desc = null, $desc = null) {
	?>
	<input type="text" name="<?php echo $settings_key; ?>[<?php echo $key; ?>]" value="<?php echo esc_attr( $settings_values[$key] ); ?>" <?php if ( $isColor == true) echo 'class="color-field"'; ?> style="width:350px" /> <?php if ( $short_desc ) echo $short_desc; ?><br><br>
	<span style="color:#999"><em><?php if ( $desc ) echo $desc; ?></em></span>
	<?php
}

function gl_field_googleActive( ) {
    gl_field_checkbox( gl_get_general_settings_values(), gl_get_general_settings_key(), 'google_active', 'Activate/Deactivate' );
}

function gl_field_google_share( ) {
    gl_field_checkbox( gl_get_general_settings_values(), gl_get_general_settings_key(), 'google_share', 'Activate/Deactivate' );
}

function gl_field_googleURL( ) {
    gl_field_text( gl_get_general_settings_values(), gl_get_general_settings_key(), 'google_url', false, null, 'Insert the URL which you want to share or follow. Example: http://www.wptpnet' );
}

function gl_field_youtube_active( ) {
    gl_field_checkbox( gl_get_general_settings_values(), gl_get_general_settings_key(), 'youtube_active', 'Activate/Deactivate', 'Only support Youtube for Social Locker' );
}

function gl_field_youtube_channel( ) {
    gl_field_text( gl_get_general_settings_values(), gl_get_general_settings_key(), 'youtube_channel', false, null, 'Insert the YouTube channel. Example: GoogleDevelopers' );
}

function gl_field_languages( ) {
	global $languages;
	
    $general_settings = gl_get_general_settings_values();
	?>
	<select name="<?php echo gl_get_general_settings_key(); ?>[language]" id="<?php echo esc_attr( $general_settings[ 'language' ] ); ?>">
		<?php foreach( $languages as $lang ) {?>
			<option value="<?php echo $lang[0] ?>" <?php if ( $general_settings[ 'language' ] == $lang[0] ) { echo 'selected="selected"'; } ?>><?php echo $lang[1] ?></option>
		<?php }?>
	</select><br><br>
	<span style="color:#999"><em>Language for all Social</em></span>
	<?php
}

function gl_field_cookieDays( ) {
    gl_field_text( gl_get_general_settings_values(), gl_get_general_settings_key(), 'cookie_days', false, 'days', 'Default: 1 day.' );
}

/**
 * Social Locker Option field callback
 */
 function gl_field_sl_title( ) {
    gl_field_text( gl_get_social_lock_setting_values(), gl_get_social_lock_settings_key(), 'sl_title' );
}

function gl_field_sl_message( ) {
    $social_lock_settings = gl_get_social_lock_setting_values();
	?>
	<textarea rows="4" cols="50" name="<?php echo gl_get_social_lock_settings_key(); ?>[sl_message]"><?php echo esc_attr( $social_lock_settings[ 'sl_message' ] ); ?></textarea>
	<?php
}

function gl_field_sl_style() {
	$social_lock_settings = gl_get_social_lock_setting_values();
	?>
	<select name="<?php echo gl_get_social_lock_settings_key(); ?>[sl_style]" id="<?php echo esc_attr( $social_lock_settings[ 'sl_style' ] ); ?>">
		<option value="starter" <?php if ( $social_lock_settings[ 'sl_style' ] == 'starter' ) { echo 'selected="selected"'; } ?>>Starter</option>
		<option value="corner" <?php if(  $social_lock_settings[ 'sl_style' ] == 'corner' ) { echo 'selected="selected"'; } ?>>Corner</option>
		<option value="round" <?php if(  $social_lock_settings[ 'sl_style' ] == 'round' ) { echo 'selected="selected"'; } ?>>Round</option>
	</select><br><br>
	<span style="color:#999"><em>Only use "Round Style" with "Count Social Layout"</em></span>
	<?php
}

function gl_field_sl_title_color( ) {
    gl_field_text( gl_get_social_lock_setting_values(), gl_get_social_lock_settings_key(), 'sl_title_color', true, null, 'Title text color' );
}

function gl_field_sl_message_color( ) {
    gl_field_text( gl_get_social_lock_setting_values(), gl_get_social_lock_settings_key(), 'sl_message_color', true, null, 'Message text color' );
}

function gl_field_sl_bg_color( ) {
    gl_field_text( gl_get_social_lock_setting_values(), gl_get_social_lock_settings_key(), 'sl_bg_color', true );
}

function gl_field_sl_shadow_color( ) {
    gl_field_text( gl_get_social_lock_setting_values(), gl_get_social_lock_settings_key(), 'sl_shadow_color', true );
}
function gl_field_sl_layout() {
	$social_lock_settings = gl_get_social_lock_setting_values();
	?>
	<select name="<?php echo gl_get_social_lock_settings_key(); ?>[sl_layout]" id="<?php echo esc_attr( $social_lock_settings[ 'sl_layout' ] ); ?>">
		<option value="count" <?php if ( $social_lock_settings[ 'sl_layout' ] == 'count' ) { echo 'selected="selected"'; } ?>>Count</option>
		<option value="box" <?php if ( $social_lock_settings[ 'sl_layout' ] == 'box' ) { echo 'selected="selected"'; } ?>>Box</option>
	</select>
	<?php
}

function gl_field_sl_btn_effect( ) {
    $social_lock_settings = gl_get_social_lock_setting_values();
	?>
	<select name="<?php echo gl_get_social_lock_settings_key(); ?>[sl_btn_effect]" id="<?php echo esc_attr( $social_lock_settings[ 'sl_btn_effect' ] ); ?>">
		<option value="fade" <?php if ( $social_lock_settings[ 'sl_btn_effect' ] == 'fade' ) { echo 'selected="selected"'; } ?>>Fade</option>
		<option value="slide" <?php if ( $social_lock_settings[ 'sl_btn_effect' ] == 'slide' ) { echo 'selected="selected"'; } ?>>Slide</option>
		<option value="hide" <?php if ( $social_lock_settings[ 'sl_btn_effect' ] == 'hide' ) { echo 'selected="selected"'; } ?>>Hide/Show</option>
	</select>
	<?php
}

/**
 * Content Locker Option field callback
 */
function gl_field_cl_title( ) {
    gl_field_text( gl_get_content_lock_setting_values(), gl_get_content_lock_settings_key(), 'cl_title' );
}

function gl_field_cl_message( ) {
    $content_lock_settings = gl_get_content_lock_setting_values();
	?>
	<textarea rows="4" cols="50" name="<?php echo gl_get_content_lock_settings_key(); ?>[cl_message]"><?php echo esc_attr( $content_lock_settings[ 'cl_message' ] ); ?></textarea>
	<?php
}

function gl_field_cl_style() {
	$content_lock_settings = gl_get_content_lock_setting_values();
	?>
	<select name="<?php echo gl_get_content_lock_settings_key(); ?>[cl_style]" id="<?php echo esc_attr( $content_lock_settings[ 'cl_style' ] ); ?>">
		<option value="starter" <?php if ( $content_lock_settings[ 'cl_style' ] == 'starter' ) { echo 'selected="selected"'; } ?>>Starter</option>
		<option value="corner" <?php if ( $content_lock_settings[ 'cl_style' ] == 'corner' ) { echo 'selected="selected"'; } ?>>Corner</option>
		<option value="round" <?php if ( $content_lock_settings[ 'cl_style' ] == 'round' ) { echo 'selected="selected"'; } ?>>Round</option>
	</select><br><br>
	<span style="color:#999"><em>Only use "Round Style" with "Count Social Layout"</em></span>
	<?php
}

function gl_field_cl_title_color( ) {
    gl_field_text( gl_get_content_lock_setting_values(), gl_get_content_lock_settings_key(), 'cl_title_color', true, null, 'Title text color' );
}

function gl_field_cl_message_color( ) {
    gl_field_text( gl_get_content_lock_setting_values(), gl_get_content_lock_settings_key(), 'cl_message_color', true, null, 'Message text color' );
}

function gl_field_cl_bg_color( ) {
    gl_field_text( gl_get_content_lock_setting_values(), gl_get_content_lock_settings_key(), 'cl_bg_color', true );
}

function gl_field_cl_shadow_color( ) {
    gl_field_text( gl_get_content_lock_setting_values(), gl_get_content_lock_settings_key(), 'cl_shadow_color', true );
}

function gl_field_cl_layout( ) {
    $content_lock_settings = gl_get_content_lock_setting_values();
	?>
	<select name="<?php echo gl_get_content_lock_settings_key(); ?>[cl_layout]" id="<?php echo esc_attr( $content_lock_settings[ 'cl_layout' ] ); ?>">
		<option value="count" <?php if ( $content_lock_settings[ 'cl_layout' ] == 'count' ) { echo 'selected="selected"'; } ?>>Count</option>
		<option value="box" <?php if ( $content_lock_settings[ 'cl_layout' ] == 'box' ) { echo 'selected="selected"'; } ?>>Box</option>
	</select>
	<?php
}

function gl_field_cl_btn_effect( ) {
    $content_lock_settings = gl_get_content_lock_setting_values();
	?>
	<select name="<?php echo gl_get_content_lock_settings_key(); ?>[cl_btn_effect]" id="<?php echo esc_attr( $content_lock_settings[ 'cl_btn_effect' ] ); ?>">
		<option value="fade" <?php if ( $content_lock_settings[ 'cl_btn_effect' ] == 'fade' ) { echo 'selected="selected"'; } ?>>Fade</option>
		<option value="slide" <?php if ( $content_lock_settings[ 'cl_btn_effect' ] == 'slide' ) { echo 'selected="selected"'; } ?>>Slide</option>
		<option value="hide" <?php if ( $content_lock_settings[ 'cl_btn_effect' ] == 'hide' ) { echo 'selected="selected"'; } ?>>Hide/Show</option>
	</select>
	<?php
}

/**
 * Preview field callback
 */
function gl_field_preview_social( ) {
	echo gl_generate( "This is preview text", "social", "http://www.wptp.net", "GoogleDevelopers", true );
}

function gl_field_preview_content( ) {
	echo gl_generate( "This is preview text", "content", "http://www.wptp.net", "GoogleDevelopers", true );
}

/**
 * Called during admin_menu, adds an options
 * page under Settings called Google Locker, rendered
 * using the gl_plugin_options_page method.
 */
function gl_add_admin_menus( ) {
    add_options_page( 'Google Locker', 'Google Locker', 'manage_options', gl_get_plugin_options_key(), 'gl_plugin_options_page' );
}

/**
 * Plugin How to use tab
 */
function gl_plugin_howtouse_tab( ) {
	echo '
		<h3 style="text-align:center" >Thank you for choosing Google Locker plugin by WPTP Net!</h3>
		<p>
			&nbsp;</p>
		<h3>Settings Page</h3><hr class="notop">
			<p>
				The settings page allows you to configure some global options used with Google Locker.</p>
			<p>
				&nbsp;</p>
			<p>
				<strong>General Settings</strong></p>
			<p>
				Google Plus Button - Turn on / off the google +1 button.</p>
			<p>
				Google Share Button - Turn on / off the google share button.</p>
			<p>
				Google URL - Insert the URL which you want to share or follow. Example: http://www.wptpnet.</p>
			<p>
				Display Youtube - Turn on / off the youtube subscribe button.</p>
			<p>
				Youtube Channel - Insert the YouTube channel. Example: GoogleDevelopers.</p>
			<p>
				Language - Choose language that you want use with Google/Youtube buttons.</p>
			<p>
				Cookie - The plugin use cookie remember users who have already unlocked.</p>
			<p>
				&nbsp;</p>
			<p>
				<strong>Social/Content Settings</strong></p>
			<p>
				Title - You can change text for Title Locker here</p>
			<p>
				Message - You can change text for Message Lockerhere</p>
			<p>
				Style - You can change style of Locker here</p>
			<p>
				Social Layout - Support vertical (count) and horizontal (box) for counter here.</p>
			<p>
				Social Button Effect - Support 3 effects of Jquery (Fade/Slide/Hide & show)</p>
			<p>
				Preview - You can see preview for Social/Content locker.</p>
			<p>
				&nbsp;</p>
			<p>
				&nbsp;</p>
		<h3>How to Use Google Locker</h3><hr class="notop">
			<p>
				When creating a post / page you will see a new icon in your tinyMCE toolbar post editor. That is split buttons with 3 options Social, Content Locker.</p>
			<p>
				&nbsp;</p>			
			<p>
				<strong>How to Create A Content Locker</strong></p>
			<p>
				1. Select the content in the post editor that you want to lock inside.</p>
			<p>
				2. Click the lock icon. You can choose Social, Content button to insert ShortCode to content locker.</p>
		';
}

/**
 * Plugin Options page: using the gl_plugin_options_tabs method to render the tabs.
 */ 
function gl_plugin_options_page( ) {
    // Options page
    $tab = isset( $_GET[ 'tab' ] ) ? $_GET[ 'tab' ] : gl_get_general_settings_key();
	
	// Get options value after user press "Save Settings" button
	$update_settings = isset( $_GET[ "settings-updated" ] ) ? $_GET[ "settings-updated" ] : "";
    if ( $update_settings == "true" ) {	
		$general_settings = gl_get_general_settings_values();
		$parts = explode('_', $general_settings[ 'language' ]);
		$general_settings = array_merge( $general_settings, array(
				'short_language' => $parts[0]
			) );
			
		delete_option( gl_get_general_settings_key() );
		update_option( gl_get_general_settings_key(), $general_settings );
	}
    
    // reset settings
    $reset_settings = isset( $_GET[ "reset" ] ) ? $_GET[ "reset" ] : "";
    if ( $reset_settings == "true" ) {        
        if ( $tab == gl_get_general_settings_key() ) {
            delete_option( gl_get_general_settings_key() );
            update_option( gl_get_general_settings_key(), gl_general_default_settings() );
            
            $msg = "Reset General Settings Successfully.";
        } else if ( $tab == gl_get_social_lock_settings_key() ) {
            delete_option( gl_get_social_lock_settings_key() );
            update_option( gl_get_social_lock_settings_key(), gl_social_lock_default_settings() );
            
            $msg = "Reset Social Locker Settings Successfully.";
        } else if ( $tab == gl_get_content_lock_settings_key() ) {
            delete_option( gl_get_content_lock_settings_key() );
            update_option( gl_get_content_lock_settings_key(), gl_content_lock_default_settings() );
            
            $msg = "Reset Content Locker Settings Successfully.";
        } else if ( $tab == gl_get_time_lock_settings_key() ) {
            delete_option( gl_get_time_lock_settings_key() );
            update_option( gl_get_time_lock_settings_key(), gl_time_lock_default_settings() );
            
            $msg = "Reset Time Locker Settings Successfully.";
        }
    }
	?>
	<div class="wrap">
		<?php gl_plugin_options_tabs(); ?>
		<?php if ($msg != "") {
			echo '<div class="updated" style="padding: 10px;">' . $msg . '</div>';
		}
		?>
		<form method="post" action="options.php">
		<?php if ( $tab == gl_get_howtouse_settings_key() ) {
				echo gl_plugin_howtouse_tab();
			  } 
			  else {
		?>
			<?php wp_nonce_field( 'update-options' ); ?>
			<?php settings_fields( $tab ); ?>
			<?php do_settings_sections( $tab ); ?>
			<a href="options-general.php?page=<?php echo gl_get_plugin_options_key(); ?>&tab=<?php echo $tab ?>&reset=true" class="button">Reset configuration to default values</a>
			<input type="submit" name="submit" id="submit" class="button-primary" value="Save settings" >
		<?php } ?>
		</form>
	</div>
	<?php
}

/**
 * Renders our tabs in the Plugin Options page
 */ 
function gl_plugin_options_tabs( ) {
    $current_tab = isset( $_GET[ 'tab' ] ) ? $_GET[ 'tab' ] : gl_get_general_settings_key();
    
    screen_icon();
    echo '<h2 class="nav-tab-wrapper">';
    
    $plugin_settings_tabs = gl_get_plugin_settings_tabs();
    foreach ( $plugin_settings_tabs as $tab_key => $tab_caption ) {
        $active = $current_tab == $tab_key ? 'nav-tab-active' : '';
        echo '<a class="nav-tab ' . $active . '" href="?page=' . gl_get_plugin_options_key() . '&tab=' . $tab_key . '">' . $tab_caption . '</a>';
    }
    echo '</h2>';
}

/**
 * Add Settings, Admin Menu, Header & Footer to WordPress
 */
add_action( 'admin_init', 'gl_register_settings' );
add_action( 'admin_menu', 'gl_add_admin_menus' );
add_action( 'admin_footer', 'gl_get_script_footer');
?>